<?php
 namespace blobfolio\wp\wh\vendor\phone\data; use \blobfolio\wp\wh\vendor\common; use \blobfolio\wp\wh\vendor\phone\phone; abstract class data { public static function match($phone='') { common\ref\cast::to_string($phone, true); phone::sanitize_phone($phone); if (false === $phone) { return false; } $test = array($phone); $tmp = ltrim($phone, '0'); if (common\mb::substr($tmp, 0, common\mb::strlen(static::PREFIX)) === (string) static::PREFIX) { $test[] = common\mb::substr($tmp, common\mb::strlen(static::PREFIX)); } foreach ($test as $t) { foreach (static::PATTERNS as $p) { if (preg_match("/^($p)$/", $t)) { $types = static::types($t); if (!count($types)) { continue; } $out = phone::TEMPLATE; $out['country'] = static::CODE; $out['prefix'] = static::PREFIX; $out['region'] = static::REGION; $out['types'] = $types; $out['number'] = '+' . static::PREFIX . ' ' . static::format($t); return $out; } } } return false; } protected static function format($phone='') { common\ref\cast::to_string($phone, true); foreach (static::FORMATS as $k=>$v) { if (preg_match("/^($k)$/", $phone)) { return preg_replace("/^$k$/", $v, $phone); } } return $phone; } protected static function types($phone='') { common\ref\cast::to_string($phone, true); $out = array(); foreach (static::TYPES as $k=>$v) { if (preg_match("/^($k)$/", $phone)) { $out = array_merge($out, $v); } } if (count($out)) { sort($out); $out = array_unique($out); } return $out; } } 