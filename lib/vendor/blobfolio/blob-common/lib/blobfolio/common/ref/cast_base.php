<?php
 namespace blobfolio\wp\wh\vendor\common\ref; use \blobfolio\wp\wh\vendor\common\cast as v_cast; use \blobfolio\wp\wh\vendor\common\constants; use \blobfolio\wp\wh\vendor\common\mb as v_mb; abstract class cast_base { public static function to_array(&$value=null) { try { $value = (array) $value; } catch (\Throwable $e) { $value = array(); } catch (\Exception $e) { $value = array(); } return true; } public static function to_bool(&$value=false, $flatten=false) { if (!$flatten && is_array($value)) { foreach ($value as $k=>$v) { static::to_bool($value[$k]); } } else { if (is_string($value)) { mb::strtolower($value); if (in_array($value, constants::TRUE_BOOLS, true)) { $value = true; } elseif (in_array($value, constants::FALSE_BOOLS, true)) { $value = false; } else { $value = (bool) $value; } } else { try { $value = (bool) $value; } catch (\Throwable $e) { $value = false; } catch (\Exception $e) { $value = false; } } } return true; } public static function to_float(&$value=0, $flatten=false) { if (!$flatten && is_array($value)) { foreach ($value as $k=>$v) { static::to_float($value[$k]); } } else { static::to_number($value, true); try { $value = (float) $value; } catch (\Throwable $e) { $value = 0.0; } catch (\Exception $e) { $value = 0.0; } } return true; } public static function to_int(&$value=0, $flatten=false) { if (!$flatten && is_array($value)) { foreach ($value as $k=>$v) { static::to_int($value[$k]); } } else { if (is_string($value)) { mb::strtolower($value); if (in_array($value, constants::TRUE_BOOLS, true)) { $value = 1; } elseif (in_array($value, constants::FALSE_BOOLS, true)) { $value = 0; } } static::to_number($value, true); $value = (int) $value; } return true; } public static function to_number(&$value=0, $flatten=false) { if (!$flatten && is_array($value)) { foreach ($value as $k=>$v) { static::to_number($value[$k]); } } else { if (is_string($value)) { static::to_string($value); $from = array_keys(constants::NUMBER_CHARS); $to = array_values(constants::NUMBER_CHARS); $value = str_replace($from, $to, $value); if (preg_match('/^\-?[\d,]*\.?\d+Â¢$/', $value)) { $value = v_cast::to_number(preg_replace('/[^\-\d\.]/', '', $value)) / 100; } elseif (preg_match('/^\-?[\d,]*\.?\d+%$/', $value)) { $value = v_cast::to_number(preg_replace('/[^\-\d\.]/', '', $value)) / 100; } } try { $value = (float) filter_var($value, FILTER_SANITIZE_NUMBER_FLOAT, FILTER_FLAG_ALLOW_FRACTION); } catch (\Throwable $e) { $value = 0.0; } catch (\Exception $e) { $value = 0.0; } } return true; } public static function to_string(&$value='', $flatten=false) { if (!$flatten && is_array($value)) { foreach ($value as $k=>$v) { static::to_string($value[$k]); } } else { try { $value = (string) $value; sanitize::utf8($value); } catch (\Throwable $e) { $value = ''; } catch (\Exception $e) { $value = ''; } } return true; } public static function to_type(&$value, $type=null, $flatten=false) { static::to_string($type, true); if (!v_mb::strlen($type)) { return true; } mb::strtolower($type); if ('boolean' === $type || 'bool' === $type) { static::to_bool($value, $flatten); } elseif ('integer' === $type || 'int' === $type) { static::to_int($value, $flatten); } elseif ('double' === $type || 'float' === $type) { static::to_float($value, $flatten); } elseif ('string' === $type) { static::to_string($value, $flatten); } elseif ('array' === $type) { static::to_array($value); } return true; } } 